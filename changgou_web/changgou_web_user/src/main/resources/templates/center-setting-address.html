<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>
        <title>设置-个人信息</title>
        <link rel="icon" href="/img/favicon.ico">

        <link rel="stylesheet" type="text/css" href="/css/all.css"/>
        <link rel="stylesheet" type="text/css" href="/css/pages-seckillOrder.css"/>
        <script src="/js/plugins/jquery/jquery.min.js"></script>
        <script src="/js/plugins/sui/sui.min.js"></script>
        <script src="/js/address.js"></script>
        <script src="/js/vue.js"></script>
        <script src="/js/axios.js"></script>
        <!-- 引入样式 -->
        <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
        <!-- 引入组件库 -->
        <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    </head>

    <body>
        <!-- 头部栏位 -->
        <!--页面顶部-->
        <div id="nav-bottom">
            <!--顶部-->
            <div class="nav-top">
                <div class="top">
                    <div class="py-container">
                        <div class="shortcut">
                            <ul class="fl" th:unless="${username != null}">
                                <li class="f-item">畅购欢迎您！</li>
                                <li class="f-item">请
                                    <a
                                            th:href="|/api/oauth/toLogin?FROM=http://localhost:8001/api/wuser/index|"
                                            target="_self">登录</a>
                                    <span>
									<a th:href="|/api/wuser/register|" target="_self">免费注册</a>
								</span>
                                </li>
                            </ul>
                            <ul class="fl" th:unless="${username == null}">
                                <li class="f-item">畅购欢迎您！</li>
                                <li class="f-item">
                                    <em th:text="${username}" style="color: #ff3835"></em>
                                    <span>
									<a th:href="|/api/wuser/exit|">退出</a>
								</span>
                                </li>
                            </ul>
                            <div class="fr typelist">
                                <ul class="types">
                                    <li class="f-item">
                                        <span>我的订单</span>
                                    </li>

                                    <li class="f-item">
									<span>
										<a href="http://localhost:8001/api/wcart/list" target="_self">我的购物车</a>
									</span>
                                    </li>
                                    <li class="f-item">
									<span th:unless="${username ==null}">
										<a th:href="|/api/wuser/user|">个人中心</a>
									</span>
                                    </li>
                                    <li class="f-item">
                                        <span>畅购会员</span>
                                    </li>
                                    <li class="f-item">
                                        <span>企业采购</span>
                                    </li>
                                    <li class="f-item">
                                        <span>关注畅购</span>
                                    </li>
                                    <li class="f-item">
									<span>
										<a href="cooperation.html" target="_blank">合作招商</a>
									</span>
                                    </li>
                                    <li class="f-item">
									<span>
										<a href="shoplogin.html" target="_blank">商家后台</a>
									</span>
                                    </li>
                                    <li class="f-item">
                                        <span>网站导航</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!--头部-->
                <div class="header">
                    <div class="py-container">
                        <div class="yui3-g Logo">
                            <div class="yui3-u Left logoArea">
                                <a class="logo-bd" title="畅购" th:href="@{/api/wuser/index}"></a>
                            </div>
                            <div class="yui3-u Rit searchArea">
                                <div class="search">
                                    <form th:action="@{/api/search/list}" class="sui-form form-inline">
                                        <div class="input-append">
                                            <input th:type="text" id="autocomplete" name="keyWords"
                                                   class="input-error input-xxlarge"/>
                                            <button class="sui-btn btn-xlarge btn-danger" th:type="submit">搜索
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!--header-->
        <div id="account">
            <div class="py-container">
                <div class="yui3-g home">
                    <!--左侧列表-->
                    <div class="yui3-u-1-6 list">

                        <div class="person-info">
                            <div class="person-photo"><img src="http://192.168.200.128:8080/group1/M00/00/00/wKjIgF4fMhqAUqb_AAobTYlR3js265.jpg" style="width: 48px;height: 48px" alt=""></div>
                            <div class="person-account">
                                <span class="name" th:text="${username}"></span>
                                <span class="safe">账户安全</span>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="list-items">
                            <dl>
                                <dt><i>·</i> 订单中心</dt>
                                <dd><a th:href="|/api/wuser/user|">我的订单</a></dd>
                                <dd><a th:href="|/api/wuser/pay|">待付款</a></dd>
                                <dd><a th:href="|/api/wuser/sendt|">待发货</a></dd>
                                <dd><a th:href="|/api/wuser/receive|">待收货</a></dd>
                                <dd><a th:href="|/api/wuser/justtest|">待评价</a></dd>
                            </dl>
                            <dl>
                                <dt><i>·</i> 我的中心</dt>
                                <dd><a th:href="|/api/wcollect/list|">我的收藏</a></dd>
                                <dd><a th:href="|/api/wcollect/list2FootMark|">我的足迹</a></dd>
                            </dl>
                            <dl>
                                <dt><i>·</i> 设置</dt>
                                <dd><a th:href="|/api/wcenter/toCenterInfo|">个人信息</a></dd>
                                <dd><a th:href="|/api/waddress/toCenterAddress|" class="list-active">地址管理</a></dd>
                                <dd><a th:href="|/api/wcenter/toSafe|">安全管理</a></dd>
                            </dl>
                        </div>
                    </div>
                    <!--右侧主内容-->
                    <div class="yui3-u-5-6" id="app" :model="address">
                        <div class="body userAddress">
                            <div class="address-title">
                                <span class="title">地址管理</span>
                                <el-button type="primary" class="butT" @click="handleCreate()">添加新地址</el-button>
                                <span class="clearfix"></span>
                            </div>
                            <template>
                                <el-table
                                        :data="addressList"
                                        style="width: 200%"
                                        current-row-key="id">
                                    <el-table-column
                                            prop="contact"
                                            label="姓名"
                                            width="180">
                                    </el-table-column>
                                    <el-table-column
                                            prop="totalAddress"
                                            label="地址"
                                            width="180">
                                    </el-table-column>
                                    <el-table-column
                                            prop="phone"
                                            label="联系电话"
                                            width="180">
                                    </el-table-column>
                                    <el-table-column label="操作">
                                        <template slot-scope="scope">
                                            <el-button
                                                    size="mini"
                                                    @click="handleUpdate(scope.row)">编辑
                                            </el-button>
                                            <el-button
                                                    size="mini"
                                                    type="danger"
                                                    @click="handleDelete(scope.row)">删除
                                            </el-button>
                                            <el-link @click='handIsDefault(scope.row)'>
                                                <span>{{ scope.row.isDefault == '1'? '默认地址' : '设置默认地址'}}</span>
                                            </el-link>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </template>

                            <!--修改地址弹出层-->
                            <div class="add-form">
                                <el-dialog title="修改地址" :visible.sync="dialogFormVisible4Edit">
                                    <template>
                                        <el-tabs type="card">
                                            <el-tab-pane label="基本信息">
                                                <el-form ref="dataAddForm" :model="address"
                                                         label-position="right" label-width="100px">
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="联系人">
                                                                <el-input v-model="address.contact"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row>
                                                        <div class="control-group address">
                                                            <label for="inputPassword"
                                                                   class="control-label">所在地：</label>
                                                            <template>
                                                                <el-select v-model="address.province"
                                                                           style="margin-left: 5px;"
                                                                           placeholder="请选择"
                                                                           @change="findCitiesList1(address.province)">
                                                                    <el-option
                                                                            v-for="province in provincesList"
                                                                            :key="province.provinceid"
                                                                            :label="province.province"
                                                                            :value="province.province">
                                                                    </el-option>
                                                                </el-select>

                                                                <el-select
                                                                        v-model="address.city"
                                                                        collapse-tags
                                                                        style="margin-left: 5px;"
                                                                        placeholder="请选择"
                                                                        @change="findAreasList1(address.city)">
                                                                    <el-option
                                                                            v-for="city in citiesList"
                                                                            :key="city.cityid"
                                                                            :label="city.city"
                                                                            :value="city.city">
                                                                    </el-option>
                                                                </el-select>

                                                                <el-select
                                                                        v-model="address.area"
                                                                        collapse-tags
                                                                        style="margin-left: 5px;"
                                                                        placeholder="请选择">
                                                                    <el-option
                                                                            v-for="area in areasList"
                                                                            :key="area.areaid"
                                                                            :label="area.area"
                                                                            :value="area.area">
                                                                    </el-option>
                                                                </el-select>
                                                            </template>
                                                        </div>
                                                    </el-row>
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="详细地址">
                                                                <el-input v-model="address.address"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="电话">
                                                                <el-input v-model="address.phone"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="别名">
                                                                <el-input v-model="address.alias"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>

                                                </el-form>
                                            </el-tab-pane>

                                        </el-tabs>
                                    </template>
                                    <div slot="footer" class="dialog-footer">
                                        <el-button @click="dialogFormVisible4Edit = false">取消</el-button>
                                        <el-button type="primary" @click="handleEdit()">确定</el-button>
                                    </div>
                                </el-dialog>
                            </div>

                            <div class="add-form">
                                <el-dialog title="新增地址" :visible.sync="dialogFormVisible">
                                    <template>
                                        <el-tabs type="card">
                                            <el-tab-pane label="基本信息">
                                                <el-form ref="dataAddForm" :model="address"
                                                         label-position="right" label-width="100px"
                                                         :rules="rules">
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="联系人">
                                                                <el-input v-model="address.contact"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row>
                                                        <div class="control-group address">
                                                            <label for="inputPassword"
                                                                   class="control-label">所在地：</label>
                                                            <template>
                                                                <el-select v-model="address.province"
                                                                           style="margin-left: 5px;"
                                                                           placeholder="请选择"
                                                                           @change="findCitiesList(address.province)">
                                                                    <el-option
                                                                            v-for="province in provincesList"
                                                                            :key="province.provinceid"
                                                                            :label="province.province"
                                                                            :value="province.province">
                                                                    </el-option>
                                                                </el-select>

                                                                <el-select
                                                                        v-model="address.city"
                                                                        collapse-tags
                                                                        style="margin-left: 5px;"
                                                                        placeholder="请选择"
                                                                        @change="findAreasList(address.city)">
                                                                    <el-option
                                                                            v-for="city in citiesList"
                                                                            :key="city.cityid"
                                                                            :label="city.city"
                                                                            :value="city.city">
                                                                    </el-option>
                                                                </el-select>

                                                                <el-select
                                                                        v-model="address.area"
                                                                        collapse-tags
                                                                        style="margin-left: 5px;"
                                                                        placeholder="请选择">
                                                                    <el-option
                                                                            v-for="area in areasList"
                                                                            :key="area.areaid"
                                                                            :label="area.area"
                                                                            :value="area.area">
                                                                    </el-option>
                                                                </el-select>
                                                            </template>
                                                        </div>
                                                    </el-row>
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="详细地址">
                                                                <el-input v-model="address.address"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="电话" prop="phone">
                                                                <el-input @blur="qwer" v-model="address.phone"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>
                                                    <el-row>
                                                        <el-col :span="12">
                                                            <el-form-item label="别名">
                                                                <el-input v-model="address.alias"/>
                                                            </el-form-item>
                                                        </el-col>
                                                    </el-row>

                                                </el-form>
                                            </el-tab-pane>

                                        </el-tabs>
                                    </template>
                                    <div slot="footer" class="dialog-footer">
                                        <el-button @click="dialogFormVisible = false">取消</el-button>
                                        <el-button type="primary" @click="handleAdd()">确定</el-button>
                                    </div>
                                </el-dialog>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 底部栏位 -->
        <!--页面底部-->
        <div class="clearfix footer">
            <div class="py-container">
                <div class="footlink">
                    <div class="Mod-service">
                        <ul class="Mod-Service-list">
                            <li class="grid-service-item intro  intro1">

                                <i class="serivce-item fl"></i>
                                <div class="service-text">
                                    <h4>正品保障</h4>
                                    <p>正品保障，提供发票</p>
                                </div>

                            </li>
                            <li class="grid-service-item  intro intro2">

                                <i class="serivce-item fl"></i>
                                <div class="service-text">
                                    <h4>正品保障</h4>
                                    <p>正品保障，提供发票</p>
                                </div>

                            </li>
                            <li class="grid-service-item intro  intro3">

                                <i class="serivce-item fl"></i>
                                <div class="service-text">
                                    <h4>正品保障</h4>
                                    <p>正品保障，提供发票</p>
                                </div>

                            </li>
                            <li class="grid-service-item  intro intro4">

                                <i class="serivce-item fl"></i>
                                <div class="service-text">
                                    <h4>正品保障</h4>
                                    <p>正品保障，提供发票</p>
                                </div>

                            </li>
                            <li class="grid-service-item intro intro5">

                                <i class="serivce-item fl"></i>
                                <div class="service-text">
                                    <h4>正品保障</h4>
                                    <p>正品保障，提供发票</p>
                                </div>

                            </li>
                        </ul>
                    </div>
                    <div class="clearfix Mod-list">
                        <div class="yui3-g">
                            <div class="yui3-u-1-6">
                                <h4>购物指南</h4>
                                <ul class="unstyled">
                                    <li>购物流程</li>
                                    <li>会员介绍</li>
                                    <li>生活旅行/团购</li>
                                    <li>常见问题</li>
                                    <li>购物指南</li>
                                </ul>

                            </div>
                            <div class="yui3-u-1-6">
                                <h4>配送方式</h4>
                                <ul class="unstyled">
                                    <li>上门自提</li>
                                    <li>211限时达</li>
                                    <li>配送服务查询</li>
                                    <li>配送费收取标准</li>
                                    <li>海外配送</li>
                                </ul>
                            </div>
                            <div class="yui3-u-1-6">
                                <h4>支付方式</h4>
                                <ul class="unstyled">
                                    <li>货到付款</li>
                                    <li>在线支付</li>
                                    <li>分期付款</li>
                                    <li>邮局汇款</li>
                                    <li>公司转账</li>
                                </ul>
                            </div>
                            <div class="yui3-u-1-6">
                                <h4>售后服务</h4>
                                <ul class="unstyled">
                                    <li>售后政策</li>
                                    <li>价格保护</li>
                                    <li>退款说明</li>
                                    <li>返修/退换货</li>
                                    <li>取消订单</li>
                                </ul>
                            </div>
                            <div class="yui3-u-1-6">
                                <h4>特色服务</h4>
                                <ul class="unstyled">
                                    <li>夺宝岛</li>
                                    <li>DIY装机</li>
                                    <li>延保服务</li>
                                    <li>畅购E卡</li>
                                    <li>畅购通信</li>
                                </ul>
                            </div>
                            <div class="yui3-u-1-6">
                                <h4>帮助中心</h4>
                                <img src="/img/wx_cz.jpg">
                            </div>
                        </div>
                    </div>
                    <div class="Mod-copyright">
                        <ul class="helpLink">
                            <li>关于我们<span class="space"></span></li>
                            <li>联系我们<span class="space"></span></li>
                            <li>关于我们<span class="space"></span></li>
                            <li>商家入驻<span class="space"></span></li>
                            <li>营销中心<span class="space"></span></li>
                            <li>友情链接<span class="space"></span></li>
                            <li>关于我们<span class="space"></span></li>
                            <li>营销中心<span class="space"></span></li>
                            <li>友情链接<span class="space"></span></li>
                            <li>关于我们</li>
                        </ul>
                        <p>地址：北京市昌平区建材城西路金燕龙办公楼一层 邮编：100096 电话：400-618-4000 传真：010-82935100</p>
                        <p>京ICP备08001421号京公网安备110108007702</p>
                    </div>
                </div>
            </div>
        </div>
        <!--页面底部END-->


        <script th:inline="javascript">
            var app = new Vue({
                el: '#app',
                data: {
                    address: {
                        username: null,
                        province: null,
                        city: null,
                        area: null,//县/区
                        phone: null,//电话
                        address: null,//详细地址
                        contact: null,//联系人
                        isDefault: "0",//是否是默认 1默认 0否
                        alias: null,//别名
                        totalAddress: null,//总地址
                    },
                    citiesList: [],
                    provincesList: [],
                    areasList: [],
                    addressList: [],
                    dialogFormVisible4Edit: false,
                    dialogFormVisible: false,//控制添加窗口显示/隐藏
                },
                created() {
                    this.findAll();
                    this.dialogFormVisible = false;
                    this.dialogFormVisible4Edit = false;
                },
                methods: {
                    findAll() {
                        axios.get("/api/waddress/findAddressByUsername").then((res) => {
                            if (res.data.success) {
                                this.addressList = res.data.data;
                            }
                        })
                    },
                    findProvincesList() {
                        axios.get("/api/wcenter/findProvincesList").then((res) => {
                            if (res.data.success) {
                                this.provincesList = res.data.data;
                                this.address.province = res.data.data[0].province;
                                this.findCitiesList(res.data.data[0].province);
                            }
                        })
                    },
                    findCitiesList(province) {
                        axios.get("/api/wcenter/findCitiesList?province=" + province).then((res) => {
                            if (res.data.success) {
                                this.citiesList = res.data.data;
                                this.address.city = res.data.data[0].city;
                                this.findAreasList(res.data.data[0].city);
                            }
                        })
                    },
                    findAreasList(city) {
                        axios.get("/api/wcenter/findAreasList?city=" + city).then((res) => {
                            if (res.data.success) {
                                this.areasList = res.data.data;
                                this.address.area = res.data.data[0].area;
                            }
                        })
                    },
                    findCitiesList1(province) {
                        axios.get("/api/wcenter/findCitiesList?province=" + province).then((res) => {
                            if (res.data.success) {
                                this.citiesList = res.data.data;
                                this.address.city = res.data.data[0].city;
                                this.findAreasList1(res.data.data[0].city);
                            }
                        })
                    },
                    findAreasList1(city) {
                        axios.get("/api/wcenter/findAreasList?city=" + city).then((res) => {
                            if (res.data.success) {
                                this.areasList = res.data.data;
                                this.address.area = res.data.data[0].area;

                            }
                        })
                    },
                    handleCreate() {
                        this.resetForm();
                        this.dialogFormVisible = true;
                        this.findProvincesList();
                    },
                    // 重置表单
                    resetForm() {
                        this.address = {};
                    },
                    handleEdit() {
                        var testStr = /^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/;
                        if (!(testStr.test(this.address.phone))) {
                            alert("请输入正确的手机号")
                        } else {
                            axios.put("/api/waddress/update", this.address).then((res) => {
                                if (res.data.success) {
                                    alert("修改成功");
                                    this.dialogFormVisible4Edit = false;
                                    this.findAll();
                                }
                            })
                        }
                    },
                    handleDelete(row) {
                        axios.delete("/api/waddress/delete?id=" + row.id).then((res) => {
                            if (res.data.success) {
                                alert("删除成功");
                                this.findAll();
                            }
                        })
                    },
                    handleAdd() {
                        var testStr = /^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/;
                        if (!(testStr.test(this.address.phone))) {
                            alert("请输入正确的手机号")
                        } else {
                            axios.post("/api/waddress/add", this.address).then((res) => {
                                if (res.data.success) {
                                    alert("添加成功");
                                    this.dialogFormVisible = false;
                                    this.findAll();
                                }
                            })
                        }
                    },
                    qwer() {

                        var testStr = /^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/;
                        if (!(testStr.test(this.address.phone))) {
                            alert("请输入正确的手机号")
                        }
                    },
                    handleUpdate(row) {
                        this.dialogFormVisible4Edit = true;
                        axios.get("/api/waddress/findById?id=" + row.id).then((res) => {
                            if (res.data.success) {
                                this.address = res.data.data;
                                axios.get("/api/wcenter/findProvincesList").then((res) => {
                                    if (res.data.success) {
                                        this.provincesList = res.data.data;
                                    }
                                });
                                axios.get("/api/wcenter/findCitiesList?province=" + this.address.province).then((res) => {
                                    if (res.data.success) {
                                        this.citiesList = res.data.data;
                                    }
                                })
                                axios.get("/api/wcenter/findAreasList?city=" + this.address.city).then((res) => {
                                    if (res.data.success) {
                                        this.areasList = res.data.data;
                                    }
                                })

                            }
                        })
                    },
                    handIsDefault(row) {
                        axios.put("/api/waddress/updateIsDefault?id=" + row.id).then((res) => {
                            if (res.data.success) {
                                this.findAll();
                            }
                        })
                    }

                },
                // data(){
                //    var validatephone = (rule, value, callback) => {
                //        if (value .size()==11) {
                //
                //        } else {
                //            callback(new Error('请输入正确电话'));
                // 		}
                //    };
                //    return {
                //        rules: {
                //            pass: [
                //                { validator: validatephone, trigger: 'blur' }
                //            ]
                //        }
                //    };
                // }
            })
        </script>

    </body>


</html>